# Repository Pattern for Mongoose ORM

[Issues](https://github.com/umut-sahin/mongoose-repository-pattern/issues)

[Npm package page](https://www.npmjs.com/package/mongoose-repository-pattern)

## Installation

```
npm install --save mongoose-repository-pattern
```

## Pre-Usage

This repository pattern is completely based on mongoose orm. So, in order to use the pattern, you should create mongoose schemas.Here is an example schema: 

```javascript
//Content of Category.js

var mongoose = require("mongoose");
var Schema = mongoose.Schema;

var categorySchema = new Schema({
  categoryName: {
    type: String,
    required: true,
    unique: true
  },
  description: {
    type: String,
    required: false
  },
  isActive: {
    type: Boolean,
    required: true,
    default: true
  }
}, {versionKey: false});

module.exports = mongoose.model("Category", categorySchema);
```

After creating schemas you should require the package by writing:

```javascript
const repo = require("mongoose-repository-pattern");
```

Last part before using the database related functions is creating model specific Sub Repository by writing:

```javascript
const category = require("./Category")
var categoryRepo = repo(category, "mongodb://localhost/DBName");
```

Congratulations you can use database related functions :)

## Usage

## Find By ID
To get a single entity by ID: 
```javascript
categoryRepo.findByID(id).then(function(category){
  console.log(category);
}).catch(function(err) {
  console.log(err.message);
});
```
Also you can choose which columns to select in result with second parameter of function:
```javascript
categoryRepo.findByID(id, "categoryName isActive").then(function(category){
  console.log(category); // You can't get description of category because only categoryName and isActive is selected.
}).catch(function(err) {
  console.log(err.message);
});
```

## Find 

```javascript
categoryRepo.find().then(function(categories){
  console.log(categories); //Return all category entries
}).catch(function(err) {
  console.log(err.message);
});
```
To get specific data you can write parameters inside the find method like:
```javascript
categoryRepo.find({isActive: true}).then(function(categories){
  console.log(categories); //Return all category entries with true isActive column
}).catch(function(err) {
  console.log(err.message);
});
```
To get specific data's wanted columns by writing parameters inside the find method like:
```javascript
categoryRepo.find({isActive: true}, "categoryName description").then(function(categories){
  console.log(categories); //Return category entries with true isActive column but without isActive column
}).catch(function(err) {
  console.log(err.message);
});
```
To get specific data's wanted columns with skipping some entries by writing parameters inside the find method like:
```javascript
categoryRepo.find({isActive: true}, "categoryName description", 10).then(function(categories){
  console.log(categories); //Return category entries with true isActive column but without isActive column and with skipping first 10 entry.
}).catch(function(err) {
  console.log(err.message);
});
```
To get specific data's wanted columns with skipping some entries and limiting result by writing parameters inside the find method like:
```javascript
categoryRepo.find({isActive: true}, "categoryName description", 10, 10).then(function(categories){
  console.log(categories); //Return 10 category entries with true isActive column but without isActive column and with skipping first 10 entry. So it takes entries between 10-20
}).catch(function(err) {
  console.log(err.message);
});
```
To get specific data's wanted columns with skipping some entries and limiting result and sorting result by writing parameters inside the find method like:
```javascript
categoryRepo.find({isActive: true}, "categoryName description", 10, 10, {categoryName: 1}).then(function(categories){
  console.log(categories); //Return 10 category entries sorted by their categoryNames with true isActive column but without isActive column and with skipping first 10 entry. So it takes entries between 10-20 
}).catch(function(err) {
  console.log(err.message);
});
```

### You can set entries null if you wish to skip. For example
```javascript
categoryRepo.find(null, null, null, null, {categoryName: 1}).then(function(categories){
  console.log(categories); //Return all category entries sorted by their categoryNames
}).catch(function(err) {
  console.log(err.message);
});
```
or
```javascript
categoryRepo.find(null, null, null, 10, null).then(function(categories){
  console.log(categories); //Return first 10 category entry
}).catch(function(err) {
  console.log(err.message);
});
```

## Add 
```javascript
var newCategory = new category();
newCategory.categoryName = "Category 3";
newCategory.description = "My Final category";
newCategory.isActive = true;

categoryRepo.add(newCategory).then(function(category) {
  console.log(category._id); // Prints newly added categories' id.
}).catch(function(err) {
  console.log(err.message);
});
```

## Update

You have 2 options to update an entry. First one is to get category first change columns then update seperately and second option is findOneAndUpdate which find one entry with given parameters and update it with given parameters.

### First Option
```javascript
categoryRepo.findByID(id).then(function(category){
  category.categoryName = "New Category Name";
  category.isActive = false;
  categoryRepo.update(category).then(function(updatedCategory){
    console.log(updatedCategory.categoryName); //Prints New Category Name
  });
}).catch(function(err) {
  console.log(err.message);
});
```

### Second Option
```javascript
categoryRepo.findOneAndUpdate({_id: id}, {$set: {categoryName: "New Category Name"}}).then(function(updatedCategory) {
  console.log(updatedCategory.categoryName); //Prints New Category Name
}).catch(function(err) {
  console.log(err.message);
});
```

## Remove
```javascript
categoryRepo.remove(id).then(function(state) {
  console.log(state); //Prints true
}).catch(function(err) {
  console.log(err.message);
});
```
